"use strict";var ColumnComponent=function(t){return{type:"ColumnComponent",getElement:function(){return t.getElement()},getDefinition:function(){return t.getDefinition()},getField:function(){return t.getField()},getCells:function(){var e=[];return t.cells.forEach(function(t){e.push(t.getComponent())}),e},getVisibility:function(){return t.visible},show:function(){t.show()},hide:function(){t.hide()},toggle:function(){t.visible?t.hide():t.show()},delete:function(){t.delete()},_getSelf:function(){return t}}},Column=function t(e,i){var n=this;this.table=i.table,this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.element=$("<div class='tabulator-col' role='columnheader' aria-sort='none'></div>"),this.contentElement=!1,this.groupElement=$("<div class='tabulator-col-group-cols'></div>"),this.isGroup=!1,this.tooltip=!1,this.hozAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.setField(this.definition.field),this.extensions={},this.cellEvents={cellClick:!1,cellDblClick:!1,cellContext:!1,cellTap:!1,cellDblTap:!1,cellTapHold:!1},this.width=null,this.minWidth=null,this.widthFixed=!1,this.visible=!0,e.columns?(this.isGroup=!0,e.columns.forEach(function(e,i){var o=new t(e,n);n.attachColumn(o)}),n.checkColumnVisibility()):i.registerColumnField(this),e.rowHandle&&!1!==this.table.options.movableRows&&this.table.extExists("moveRow")&&this.table.extensions.moveRow.setHandle(!0),this._buildHeader()};Column.prototype.setField=function(t){this.field=t,this.fieldStructure=t?t.split("."):[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNesteData:this._setFlatData},Column.prototype.registerColumnPosition=function(t){this.parent.registerColumnPosition(t)},Column.prototype.registerColumnField=function(t){this.parent.registerColumnField(t)},Column.prototype.reRegisterPosition=function(){this.isGroup?this.columns.forEach(function(t){t.reRegisterPosition()}):this.registerColumnPosition(this)},Column.prototype._buildHeader=function(){var t,e,i,n=this,o=n.definition;n.element.empty(),n.contentElement=n._buildColumnHeaderContent(),n.element.append(n.contentElement),n.isGroup?n._buildGroupHeader():n._buildColumnHeader();var l=o.tooltipHeader||!1===o.tooltip?o.tooltipHeader:n.table.options.tooltipsHeader;l?!0===l?o.field?n.table.extensions.localize.bind("columns."+o.field,function(t){n.element.attr("title",t||o.title)}):n.element.attr("title",o.title):("function"==typeof l&&(l=l(column.getComponent())),n.element.attr("title",l)):n.element.attr("title",""),n.table.options.resizableColumns&&n.table.extExists("resizeColumns")&&n.table.extensions.resizeColumns.initializeColumn("header",n,n.element),o.headerFilter&&n.table.extExists("filter")&&n.table.extExists("edit")&&(void 0!==o.headerFilterPlaceholder&&o.field&&n.table.extensions.localize.setHeaderFilterColumnPlaceholder(o.field,o.headerFilterPlaceholder),n.table.extensions.filter.initializeColumn(n)),n.table.extExists("frozenColumns")&&n.table.extensions.frozenColumns.initializeColumn(n),n.table.options.movableColumns&&!n.isGroup&&n.table.extExists("moveColumn")&&n.table.extensions.moveColumn.initializeColumn(n),(o.topCalc||o.bottomCalc)&&n.table.extExists("columnCalcs")&&n.table.extensions.columnCalcs.initializeColumn(n),"function"==typeof o.headerClick&&n.element.on("click",function(t){o.headerClick(t,n.getComponent())}),"function"==typeof o.headerDblClick&&n.element.on("dblclick",function(t){o.headerDblClick(t,n.getComponent())}),"function"==typeof o.headerContext&&n.element.on("contextmenu",function(t){o.headerContext(t,n.getComponent())}),"function"==typeof o.headerTap&&(i=!1,n.element.on("touchstart",function(t){i=!0}),n.element.on("touchend",function(t){i&&o.headerTap(t,n.getComponent()),i=!1})),"function"==typeof o.headerDblTap&&(t=null,n.element.on("touchend",function(e){t?(clearTimeout(t),t=null,o.headerDblTap(e,n.getComponent())):t=setTimeout(function(){clearTimeout(t),t=null},300)})),"function"==typeof o.headerTapHold&&(e=null,n.element.on("touchstart",function(t){clearTimeout(e),e=setTimeout(function(){clearTimeout(e),e=null,i=!1,o.headerTapHold(t,n.getComponent())},1e3)}),n.element.on("touchend",function(t){clearTimeout(e),e=null})),"function"==typeof o.cellClick&&(n.cellEvents.cellClick=o.cellClick),"function"==typeof o.cellDblClick&&(n.cellEvents.cellDblClick=o.cellDblClick),"function"==typeof o.cellContext&&(n.cellEvents.cellContext=o.cellContext),"function"==typeof o.cellTap&&(n.cellEvents.cellTap=o.cellTap),"function"==typeof o.cellDblTap&&(n.cellEvents.cellDblTap=o.cellDblTap),"function"==typeof o.cellTapHold&&(n.cellEvents.cellTapHold=o.cellTapHold)},Column.prototype._buildColumnHeader=function(){var t=this,e=t.definition,i=t.table;i.extExists("sort")&&i.extensions.sort.initializeColumn(t,t.contentElement),i.extExists("format")&&i.extensions.format.initializeColumn(t),void 0!==e.editor&&i.extExists("edit")&&i.extensions.edit.initializeColumn(t),void 0!==e.mutator&&i.extExists("mutator")&&i.extensions.mutator.initializeColumn(t),void 0!==e.accessor&&i.extExists("accessor")&&i.extensions.accessor.initializeColumn(t),void 0!==e.visible&&(e.visible?t.show():t.hide()),e.cssClass&&t.element.addClass(e.cssClass),t.setMinWidth(void 0===e.minWidth?t.table.options.columnMinWidth:e.minWidth),t.reinitializeWidth(),t.tooltip=t.definition.tooltip||!1===t.definition.tooltip?t.definition.tooltip:t.table.options.tooltips,t.hozAlign=void 0===t.definition.align?"":t.definition.align},Column.prototype._buildColumnHeaderContent=function(){var t=this,e=(t.definition,t.table,$("<div class='tabulator-col-content'></div>"));return e.append(t._buildColumnHeaderTitle()),e},Column.prototype._buildColumnHeaderTitle=function(){var t=this,e=t.definition,i=t.table,n=$("<div class='tabulator-col-title'></div>");if(e.editableTitle){var o=$("<input class='tabulator-title-editor'>");o.on("click",function(t){t.stopPropagation(),$(this).focus()}),o.on("change",function(){var n=$(this).val();e.title=n,i.options.columnTitleChanged(t.getComponent())}),n.append(o),e.field?i.extensions.localize.bind("columns."+e.field,function(t){o.val(t||e.title||"&nbsp")}):o.val(e.title||"&nbsp")}else e.field?i.extensions.localize.bind("columns."+e.field,function(t){n.html(t||e.title||"&nbsp")}):n.html(e.title||"&nbsp");return n},Column.prototype._buildGroupHeader=function(){var t=this,e=t.definition;t.table;t.element.addClass("tabulator-col-group").attr("role","columngroup").attr("aria-title",e.title),t.element.append(t.groupElement)},Column.prototype._getFlatData=function(t){return t[this.field]},Column.prototype._getNestedData=function(t){for(var e,i=t,n=this.fieldStructure,o=n.length,l=0;l<o&&(i=i[n[l]],e=i,i);l++);return e},Column.prototype._setFlatData=function(t,e){t[this.field]=e},Column.prototype._setNesteData=function(t,e){for(var i=t,n=this.fieldStructure,o=n.length,l=0;l<o;l++)l==o-1?i[n[l]]=e:(i[n[l]]||(i[n[l]]={}),i=i[n[l]])},Column.prototype.attachColumn=function(t){var e=this;e.groupElement&&(e.columns.push(t),e.groupElement.append(t.getElement()))},Column.prototype.verticalAlign=function(t){this.parent.isGroup?this.element.css("height",this.parent.getGroupElement().innerHeight()):this.element.css("height",this.parent.getHeadersElement().innerHeight()),this.isGroup||"top"===t||("bottom"===t?this.element.css({"padding-top":this.element.innerHeight()-this.contentElement.outerHeight()}):this.element.css({"padding-top":(this.element.innerHeight()-this.contentElement.outerHeight())/2})),this.columns.forEach(function(e){e.verticalAlign(t)})},Column.prototype.clearVerticalAlign=function(){this.element.css("padding-top",""),this.element.css("height",""),this.columns.forEach(function(t){t.clearVerticalAlign()})},Column.prototype.getElement=function(){return this.element},Column.prototype.getGroupElement=function(){return this.groupElement},Column.prototype.getField=function(){return this.field},Column.prototype.getFirstColumn=function(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this},Column.prototype.getLastColumn=function(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this},Column.prototype.getColumns=function(){return this.columns},Column.prototype.getCells=function(){return this.cells},Column.prototype.getTopColumn=function(){return this.parent.isGroup?this.parent.getTopColumn():this},Column.prototype.getDefinition=function(t){var e=[];return this.isGroup&&t&&(this.columns.forEach(function(t){e.push(t.getDefinition(!0))}),this.definition.columns=e),this.definition},Column.prototype.checkColumnVisibility=function(){var t=!1;this.columns.forEach(function(e){e.visible&&(t=!0)}),t?(this.show(),this.parent.table.options.columnVisibilityChanged(this.getComponent(),!1)):this.hide()},Column.prototype.show=function(){this.visible||(this.visible=!0,this.element.show(),this.table.columnManager._verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.show()}),this.table.options.persistentLayout&&this.table.extExists("persistentLayout",!0)&&this.table.extensions.persistentLayout.save(),this.table.options.groupVisibilityChanged(this.getComponent(),!0))},Column.prototype.hide=function(){this.visible&&(this.visible=!1,this.element.hide(),this.table.columnManager._verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.hide()}),this.table.options.persistentLayout&&this.table.extExists("persistentLayout",!0)&&this.table.extensions.persistentLayout.save(),this.table.options.groupVisibilityChanged(this.getComponent(),!1))},Column.prototype.setWidth=function(t){this.widthFixed=!0,this.setWidthActual(t)},Column.prototype.setWidthActual=function(t){isNaN(t)&&(t=Math.floor(this.table.element.innerWidth()/100*parseInt(t))),t=Math.max(this.minWidth,t),this.width=t,this.isGroup||(this.element.css("width",t||""),this.cells.forEach(function(e){e.setWidth(t)})),this.table.extExists("frozenColumns")&&this.table.extensions.frozenColumns.layout()},Column.prototype.checkCellHeights=function(){var t=[];this.cells.forEach(function(e){e.row.heightInitialized&&(null!==e.row.element[0].offsetParent?(t.push(e.row),e.row.clearCellHeight()):e.row.heightInitialized=!1)}),t.forEach(function(t){t.calcHeight()}),t.forEach(function(t){t.setCellHeight()})},Column.prototype.getWidth=function(){return this.element.outerWidth()},Column.prototype.getHeight=function(){return this.element.outerHeight()},Column.prototype.setMinWidth=function(t){this.minWidth=t,this.element.css("min-width",t||""),this.cells.forEach(function(e){e.setMinWidth(t)})},Column.prototype.delete=function(){this.isGroup&&this.columns.forEach(function(t){t.delete()});for(var t=this.cells.length,e=0;e<t;e++)this.cells[0].delete();this.element.detach(),this.table.columnManager.deregisterColumn(this)},Column.prototype.generateCell=function(t){var e=this,i=new Cell(e,t);return this.cells.push(i),i},Column.prototype.reinitializeWidth=function(){this.widthFixed=!1,void 0!==this.definition.width&&this.setWidth(this.definition.width),this.fitToData()},Column.prototype.fitToData=function(){var t=this;this.widthFixed||(this.element.css("width",""),t.cells.forEach(function(t){t.setWidth("")}));var e=this.element.outerWidth();t.width&&this.widthFixed||(t.cells.forEach(function(t){var i=t.getWidth();i>e&&(e=i)}),e&&t.setWidthActual(e+1))},Column.prototype.deleteCell=function(t){var e=this.cells.indexOf(t);e>-1&&this.cells.splice(e,1)},Column.prototype.getComponent=function(){return new ColumnComponent(this)};