"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ColumnCalcs=function(t){this.table=t,this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=$("<div class='tabulator-calcs-holder'></div>"),this.botElement=$("<div class='tabulator-calcs-holder'></div>"),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.initialize()};ColumnCalcs.prototype.initialize=function(){this.genColumn=new Column({field:"value"},this)},ColumnCalcs.prototype.registerColumnField=function(){},ColumnCalcs.prototype.initializeColumn=function(t){var o=t.definition,n={topCalcParams:o.topCalcParams||{},botCalcParams:o.bottomCalcParams||{}};if(o.topCalc){switch(_typeof(o.topCalc)){case"string":this.calculations[o.topCalc]&&(n.topCalc=this.calculations[o.topCalc]);break;case"function":n.topCalc=o.topCalc}n.topCalc&&(t.extensions.columnCalcs=n,this.topCalcs.push(t),this.table.options.groupBy||this.initializeTopRow())}if(o.bottomCalc){switch(_typeof(o.bottomCalc)){case"string":this.calculations[o.bottomCalc]&&(n.botCalc=this.calculations[o.bottomCalc]);break;case"function":n.botCalc=o.bottomCalc}n.botCalc&&(t.extensions.columnCalcs=n,this.botCalcs.push(t),this.table.options.groupBy||this.initializeBottomRow())}},ColumnCalcs.prototype.initializeTopRow=function(){this.topInitialized||(this.table.columnManager.element.append(this.topElement),this.topInitialized=!0)},ColumnCalcs.prototype.initializeBottomRow=function(){this.botInitialized||(this.table.footerManager.prepend(this.botElement),this.botInitialized=!0)},ColumnCalcs.prototype.scrollHorizontal=function(t){this.table.columnManager.element[0].scrollWidth,this.table.element.innerWidth();this.botInitialized&&this.botRow.getElement().css("margin-left",-t)},ColumnCalcs.prototype.recalc=function(t){var o;(this.topInitialized||this.botInitialized)&&(this.rowsToData(t),this.topInitialized&&(o=this.generateRow("top",this.rowsToData(t)),this.topRow=o,this.topElement.empty(),this.topElement.append(o.getElement()),o.initialize(!0)),this.botInitialized&&(o=this.generateRow("bottom",this.rowsToData(t)),this.botRow=o,this.botElement.empty(),this.botElement.append(o.getElement()),o.initialize(!0)),this.table.rowManager.adjustTableSize(),this.table.extExists("frozenColumns")&&this.table.extensions.frozenColumns.layout())},ColumnCalcs.prototype.generateTopRow=function(t){return this.generateRow("top",this.rowsToData(t))},ColumnCalcs.prototype.generateBottomRow=function(t){return this.generateRow("bottom",this.rowsToData(t))},ColumnCalcs.prototype.rowsToData=function(t){var o=[];return t.forEach(function(t){o.push(t.getData())}),o},ColumnCalcs.prototype.generateRow=function(t,o){var n=this,i=this.generateRowData(t,o),e=new Row(i,this);return e.getElement().addClass("tabulator-calcs").addClass("tabulator-calcs-"+t),e.type="calc",e.generateCells=function(){var t=[];n.table.columnManager.columnsByIndex.forEach(function(o){if(o.visible){n.genColumn.setField(o.getField()),n.genColumn.hozAlign=o.hozAlign;var i=new Cell(n.genColumn,e);i.column=o,i.setWidth(o.getWidth()),o.cells.push(i),t.push(i)}}),this.cells=t},e},ColumnCalcs.prototype.generateRowData=function(t,o){var n={},i="top"==t?this.topCalcs:this.botCalcs,e="top"==t?"topCalc":"botCalc";return i.forEach(function(t){var i=[];t.extensions.columnCalcs&&t.extensions.columnCalcs[e]&&(o.forEach(function(o){i.push(t.getFieldValue(o))}),t.setFieldValue(n,t.extensions.columnCalcs[e](i,o,t.extensions.columnCalcs[e+"Params"])))}),n},ColumnCalcs.prototype.hasTopCalcs=function(){return!!this.topCalcs.length},ColumnCalcs.prototype.hasBottomCalcs=function(){return!!this.botCalcs.length},ColumnCalcs.prototype.redraw=function(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)},ColumnCalcs.prototype.calculations={avg:function(t,o,n){var i=0,e=void 0!==n.precision?n.precision:2;return t.length&&(i=t.reduce(function(t,o){return t+o}),i/=t.length,i=!1!==e?i.toFixed(e):i),parseFloat(i).toString()},max:function(t,o,n){var i=null;return t.forEach(function(t){(t>i||null===i)&&(i=t)}),null!==i?i:""},min:function(t,o,n){var i=null;return t.forEach(function(t){(t<i||null===i)&&(i=t)}),null!==i?i:""},sum:function(t,o,n){var i=0;return t.length&&t.forEach(function(t){i+=isNaN(t)?0:Number(t)}),i},concat:function(t,o,n){var i=0;return t.length&&(i=t.reduce(function(t,o){return String(t)+String(o)})),i},count:function(t,o,n){var i=0;return t.length&&t.forEach(function(t){t&&i++}),i}},Tabulator.registerExtension("columnCalcs",ColumnCalcs);