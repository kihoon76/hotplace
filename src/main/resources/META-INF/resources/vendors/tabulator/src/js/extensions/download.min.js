"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Download=function(t){this.table=t,this.fields={}};Download.prototype.download=function(t,o,e){var n=this,i=!1;"function"==typeof t?i=t:n.downloaders[t]&&(i=n.downloaders[t]),i&&i.call(this,n.processDefinitions(),n.processData(),e,function(e,i){n.triggerDownload(e,i,t,o)})},Download.prototype.processDefinitions=function(){var t=this,o=t.table.columnManager.getDefinitions(),e=[];return t.fields={},o.forEach(function(o){o.field&&(t.fields[o.field]=o.field.split("."),!1!==o.download&&e.push(o))}),e},Download.prototype.processData=function(){var t=this,o=t.table.rowManager.getData(!0);return"function"==typeof t.table.options.downloadDataMutator&&(o=t.table.options.downloadDataMutator(o)),o},Download.prototype.triggerDownload=function(t,o,e,n){var i=document.createElement("a"),a=new Blob([t],{type:o}),n=n||"Tabulator."+("function"==typeof e?"txt":e);navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,n):(i.setAttribute("href",window.URL.createObjectURL(a)),i.setAttribute("download",n),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i))},Download.prototype.getFieldValue=function(t,o){for(var e,n=o,i=this.fields[t],a=i.length,r=0;r<a&&(n=n[i[r]],e=n,n);r++);return e},Download.prototype.downloaders={csv:function(t,o,e,n){var i,a=this,r=[],l=[],s=e&&e.delimiter?e.delimiter:",";t.forEach(function(t){t.field&&(r.push('"'+String(t.title).split('"').join('""')+'"'),l.push(t.field))}),i=[r.join(s)],o.forEach(function(t){var o=[];l.forEach(function(e){var n=a.getFieldValue(e,t);switch(void 0===n?"undefined":_typeof(n)){case"object":n=JSON.stringify(n);break;case"undefined":case"null":n="";break;default:n=n}o.push('"'+String(n).split('"').join('""')+'"')}),i.push(o.join(s))}),n(i.join("\n"),"text/csv")},json:function(t,o,e,n){n(JSON.stringify(o,null,"\t"),"application/json")},xlsx:function(t,o,e,n){var i,a=this,r=[],l=[],s=[],f={SheetNames:["Sheet1"],Sheets:{}};t.forEach(function(t){t.field&&(r.push(t.title),l.push(t.field))}),s.push(r),o.forEach(function(t){var o=[];l.forEach(function(e){o.push(a.getFieldValue(e,t))}),s.push(o)}),i=function(){var t={},o={s:{c:0,r:0},e:{c:l.length,r:s.length}};return s.forEach(function(o,e){o.forEach(function(o,n){var i={v:void 0===o||null===o?"":o};if(null!=i){switch(_typeof(i.v)){case"number":i.t="n";break;case"boolean":i.t="b";break;default:i.t="s"}t[XLSX.utils.encode_cell({c:n,r:e})]=i}})}),t["!ref"]=XLSX.utils.encode_range(o),t}(),f.Sheets.Sheet1=i,n(function(t){for(var o=new ArrayBuffer(t.length),e=new Uint8Array(o),n=0;n!=t.length;++n)e[n]=255&t.charCodeAt(n);return o}(XLSX.write(f,{bookType:"xlsx",bookSST:!0,type:"binary"})),"application/octet-stream")}},Tabulator.registerExtension("download",Download);