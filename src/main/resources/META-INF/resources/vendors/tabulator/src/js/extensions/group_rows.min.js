"use strict";var GroupComponent=function(t){return{type:"GroupComponent",getKey:function(){return t.key},getElement:function(){return t.element},getRows:function(){var o=[];return t.rows.forEach(function(t){o.push(t.getComponent())}),o},getSubGroups:function(){var o=[];return t.groupList.forEach(function(t){o.push(t.getComponent())}),o},getParentGroup:function(){return!!t.parent&&t.parent.getComponent()},getVisibility:function(){return t.visible},show:function(){t.show()},hide:function(){t.hide()},toggle:function(){t.toggleVisibility()},_getSelf:function(){return t}}},Group=function(t,o,e,i,r,n){this.groupManager=t,this.parent=o,this.key=i,this.level=e,this.hasSubGroups=e<t.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=n,this.rows=[],this.groups=[],this.groupList=[],this.generator=r,this.element=$("<div class='tabulator-row tabulator-group tabulator-group-level-"+e+"' role='rowgroup'></div>"),this.arrowElement=$("<div class='tabulator-arrow'></div>"),this.height=0,this.outerHeight=0,this.initialized=!1,this.visible=n?n.visible:void 0!==t.startOpen[e]?t.startOpen[e]:t.startOpen[0],this.addBindings()};Group.prototype.addBindings=function(){var t=this;t.arrowElement.on("click",function(o){o.stopPropagation(),o.stopImmediatePropagation(),t.toggleVisibility()})},Group.prototype._addRowToGroup=function(t){var o=this.level+1;if(this.hasSubGroups){var e=this.groupManager.groupIDLookups[o](t.getData());if(!this.groups[e]){var i=new Group(this.groupManager,this,o,e,this.groupManager.headerGenerator[o]||this.groupManager.headerGenerator[0],!!this.old&&this.old.groups[e]);this.groups[e]=i,this.groupList.push(i)}this.groups[e].addRow(t)}},Group.prototype._addRow=function(t){this.rows.push(t)},Group.prototype.getHeadersAndRows=function(){var t=[];return t.push(this),this._visSet(),this.visible&&(this.groupList.length?this.groupList.forEach(function(o){t=t.concat(o.getHeadersAndRows())}):(this.groupManager.table.extExists("columnCalcs")&&this.groupManager.table.extensions.columnCalcs.hasTopCalcs()&&t.push(this.groupManager.table.extensions.columnCalcs.generateTopRow(this.rows)),t=t.concat(this.rows),this.groupManager.table.extExists("columnCalcs")&&this.groupManager.table.extensions.columnCalcs.hasBottomCalcs()&&t.push(this.groupManager.table.extensions.columnCalcs.generateBottomRow(this.rows)))),t},Group.prototype.getRows=function(){return this._visSet(),this.visible?this.rows:[]},Group.prototype.getRowCount=function(){var t=0;return this.groupList.length?this.groupList.forEach(function(o){t+=o.getRowCount()}):t=this.rows.length,t},Group.prototype.toggleVisibility=function(){this.visible?this.hide():this.show()},Group.prototype.hide=function(){this.visible=!1,"classic"==this.groupManager.table.rowManager.getRenderMode()?this.rows.forEach(function(t){t.getElement().detach()}):this.groupManager.updateGroupRows(!0),this.groupManager.table.options.groupVisibilityChanged(this.getComponent(),!1)},Group.prototype.show=function(){var t=this;t.visible=!0,"classic"==this.groupManager.table.rowManager.getRenderMode()?t.rows.forEach(function(o){t.getElement().after(o.getElement()),o.initialize()}):this.groupManager.updateGroupRows(!0),this.groupManager.table.options.groupVisibilityChanged(this.getComponent(),!0)},Group.prototype._visSet=function(){var t=[];"function"==typeof this.visible&&(this.rows.forEach(function(o){t.push(o.getData())}),this.visible=this.visible(this.key,this.getRowCount(),t))},Group.prototype.getElement=function(){this.addBindingsd=!1,this._visSet();var t=[];return this.rows.forEach(function(o){t.push(o.getData())}),this.visible?this.element.addClass("tabulator-group-visible"):this.element.removeClass("tabulator-group-visible"),this.element.children().detach(),this.element.html(this.generator(this.key,this.getRowCount(),t)).prepend(this.arrowElement),this.addBindings(),this.element},Group.prototype.normalizeHeight=function(){this.setHeight(this.element.innerHeight())},Group.prototype.initialize=function(t){this.initialized&&!t||(this.normalizeHeight(),this.initialized=!0)},Group.prototype.reinitialize=function(){this.initialized=!1,this.height=0,this.element.is(":visible")&&this.initialize(!0)},Group.prototype.setHeight=function(t){this.height!=t&&(this.height=t,this.outerHeight=this.element.outerHeight())},Group.prototype.getHeight=function(){return this.outerHeight},Group.prototype.reinitializeHeight=function(){},Group.prototype.calcHeight=function(){},Group.prototype.setCellHeight=function(){},Group.prototype.clearCellHeight=function(){},Group.prototype.getComponent=function(){return new GroupComponent(this)};var GroupRows=function(t){this.table=t,this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.groups={}};GroupRows.prototype.initialize=function(){var t=this,o=t.table.options.groupBy,e=t.table.options.groupStartOpen,i=t.table.options.groupHeader;t.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],t.table.extensions.localize.bind("groups.item",function(o,e){t.headerGenerator[0]=function(t,i,r){return t+"<span>("+i+" "+(1===i?o:e.groups.items)+")</span>"}}),this.groupIDLookups=[],Array.isArray(o)||(o=[o]),o.forEach(function(o){var e,i;e="function"==typeof o?o:(i=t.table.columnManager.getColumnByField(o))?function(t){return i.getFieldValue(t)}:function(t){return t[o]},t.groupIDLookups.push(e)}),e&&(Array.isArray(e)||(e=[e]),e.forEach(function(t){t="function"==typeof t?t:function(){return!0}}),t.startOpen=e),i&&(t.headerGenerator=Array.isArray(i)?i:[i])},GroupRows.prototype.getRows=function(t){var o=this,e=[];return o.groupIDLookups.length?(o.table.options.dataGrouping(),this.generateGroups(t),o.table.options.dataGrouped&&(o.groupList.forEach(function(t){e.push(t.getComponent())}),o.table.options.dataGrouped(e)),this.updateGroupRows()):t.slice(0)},GroupRows.prototype.generateGroups=function(t){var o=this,e=o.groups;o.groups={},o.groupList=[],t.forEach(function(t){var i=o.groupIDLookups[0](t.getData());if(!o.groups[i]){var r=new Group(o,!1,0,i,o.headerGenerator[0],e[i]);o.groups[i]=r,o.groupList.push(r)}o.groups[i].addRow(t)})},GroupRows.prototype.updateGroupRows=function(t){var o,e=this,i=[];return e.groupList.forEach(function(t){i=i.concat(t.getHeadersAndRows())}),t&&(o=e.table.rowManager.displayRowsCount,e.table.rowManager.setDisplayRows(i),e.table.rowManager._virtualRenderFill(Math.floor(e.table.rowManager.element.scrollTop()/e.table.rowManager.element[0].scrollHeight*o))),i},GroupRows.prototype.scrollHeaders=function(t){this.groupList.forEach(function(o){o.arrowElement.css("margin-left",t)})},Tabulator.registerExtension("groupRows",GroupRows);