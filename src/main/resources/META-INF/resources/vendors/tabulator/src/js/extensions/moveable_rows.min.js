"use strict";var MoveRows=function(e){this.table=e,this.placeholderElement=$("<div class='tabulator-row tabulator-row-placeholder'></div>"),this.hoverElement=$(),this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this)};MoveRows.prototype.setHandle=function(e){this.hasHandle=e},MoveRows.prototype.initializeRow=function(e){var o=this,t={};t.mousemove=function(t){t.pageY-e.element.offset().top+o.table.rowManager.element.scrollTop()>e.getHeight()/2?o.toRow===e&&o.toRowAfter||(e.element.after(o.placeholderElement),o.moveRow(e,!0)):(o.toRow!==e||o.toRowAfter)&&(e.element.before(o.placeholderElement),o.moveRow(e,!1))}.bind(o),this.hasHandle||(e.getElement().on("mousedown",function(t){o.checkTimeout=setTimeout(function(){o.startMove(t,e)},o.checkPeriod)}),e.getElement().on("mouseup",function(e){o.checkTimeout&&clearTimeout(o.checkTimeout)})),e.extensions.moveRow=t},MoveRows.prototype.initializeCell=function(e){var o=this;e.getElement().on("mousedown",function(t){o.checkTimeout=setTimeout(function(){o.startMove(t,e.row)},o.checkPeriod)}),e.getElement().on("mouseup",function(e){o.checkTimeout&&clearTimeout(o.checkTimeout)})},MoveRows.prototype._bindMouseMove=function(){this.table.rowManager.displayRows.forEach(function(e){"row"===e.type&&e.extensions.moveRow.mousemove&&e.element.on("mousemove",e.extensions.moveRow.mousemove)})},MoveRows.prototype._unbindMouseMove=function(){this.table.rowManager.displayRows.forEach(function(e){"row"===e.type&&e.extensions.moveRow.mousemove&&e.element.off("mousemove",e.extensions.moveRow.mousemove)})},MoveRows.prototype.startMove=function(e,o){var t=this,n=o.getElement();t.moving=o,t.startY=e.pageY-n.offset().top,t.table.element.addClass("tabulator-block-select"),t.placeholderElement.css({width:o.getWidth(),height:o.getHeight()}),n.before(t.placeholderElement),n.detach(),t.hoverElement=n.clone(),t.hoverElement.addClass("tabulator-moving"),t.table.rowManager.getTableElement().append(t.hoverElement),t.hoverElement.css({left:0,top:0}),t._bindMouseMove(),$("body").on("mousemove",t.moveHover),$("body").on("mouseup",t.endMove),t.moveHover(e)},MoveRows.prototype.endMove=function(e){var o=this;o._unbindMouseMove(),o.placeholderElement.after(o.moving.getElement()),o.placeholderElement.detach(),o.hoverElement.detach(),o.table.element.removeClass("tabulator-block-select"),o.toRow&&o.table.rowManager.moveRow(o.moving,o.toRow,o.toRowAfter),o.moving=!1,o.toRow=!1,o.toRowAfter=!1,$("body").off("mousemove",o.moveHover),$("body").off("mouseup",o.endMove)},MoveRows.prototype.moveRow=function(e,o){var t=this;t.toRow=e,t.toRowAfter=o},MoveRows.prototype.moveHover=function(e){var o=this,t=o.table.rowManager.getElement(),n=t.scrollTop(),s=e.pageY-t.offset().top+n;o.hoverElement.css({top:s-o.startY})},Tabulator.registerExtension("moveRow",MoveRows);