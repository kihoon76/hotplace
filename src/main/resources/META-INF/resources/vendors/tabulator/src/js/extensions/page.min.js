"use strict";var Page=function(t){this.table=t,this.element=$("<span class='tabulator-paginator'></span>"),this.pagesElement=$("<span class='tabulator-pages'></span>"),this.firstBut=$("<button class='tabulator-page' data-page='first' role='button' aria-label='' title=''></button>"),this.prevBut=$("<button class='tabulator-page' data-page='prev' role='button' aria-label='' title=''></button>"),this.nextBut=$("<button class='tabulator-page' data-page='next' role='button' aria-label='' title=''></button>"),this.lastBut=$("<button class='tabulator-page' data-page='last' role='button' aria-label='' title=''></button>"),this.mode="local",this.size=0,this.page=1,this.max=1,this.paginator=!1};Page.prototype.initialize=function(){var t=this;for(var e in t.table.options.paginationDataSent)t.paginationDataSentNames[e]=t.table.options.paginationDataSent[e];for(var a in t.table.options.paginationDataReceived)t.paginationDataReceivedNames[a]=t.table.options.paginationDataReceived[a];t.table.options.paginator&&(t.paginator=t.table.options.paginator),t.table.extensions.localize.bind("pagination.first",function(e){t.firstBut.html(e)}),t.table.extensions.localize.bind("pagination.first_title",function(e){t.firstBut.attr("aria-label",e).attr("title",e)}),t.table.extensions.localize.bind("pagination.prev",function(e){t.prevBut.html(e)}),t.table.extensions.localize.bind("pagination.prev_title",function(e){t.prevBut.attr("aria-label",e).attr("title",e)}),t.table.extensions.localize.bind("pagination.next",function(e){t.nextBut.html(e)}),t.table.extensions.localize.bind("pagination.next_title",function(e){t.nextBut.attr("aria-label",e).attr("title",e)}),t.table.extensions.localize.bind("pagination.last",function(e){t.lastBut.html(e)}),t.table.extensions.localize.bind("pagination.last_title",function(e){t.lastBut.attr("aria-label",e).attr("title",e)}),t.firstBut.on("click",function(){t.setPage(1)}),t.prevBut.on("click",function(){t.previousPage()}),t.nextBut.on("click",function(){t.nextPage()}),t.lastBut.on("click",function(){t.setPage(t.max)}),t.table.options.paginationElement&&(t.element=t.table.options.paginationElement),t.element.append(t.firstBut),t.element.append(t.prevBut),t.element.append(t.pagesElement),t.element.append(t.nextBut),t.element.append(t.lastBut),t.table.options.paginationElement||t.table.footerManager.append(t.element,t),t.mode=t.table.options.pagination,t.size=t.table.options.paginationSize||Math.floor(t.table.rowManager.getElement().innerHeight()/26)},Page.prototype.setMaxRows=function(t){this.max=t?Math.ceil(t/this.size):1,this.page>this.max&&(this.page=this.max)},Page.prototype.reset=function(t){return("local"==this.mode||t)&&(this.page=1),!0},Page.prototype.setMaxPage=function(t){this.max=t||1,this.page>this.max&&(this.page=this.max,this.trigger())},Page.prototype.setPage=function(t){return t>0&&t<=this.max&&(this.page=t,this.trigger(),!0)},Page.prototype.setPageSize=function(t){t>0&&(this.size=t)},Page.prototype._setPageButtons=function(){var t=this,e=this.page<this.max-2?this.page-2:this.page-(4-(this.max-this.page)),a=this.page>3?this.page+2:this.page+(5-this.page);t.pagesElement.empty(),1==t.page?(t.firstBut.prop("disabled",!0),t.prevBut.prop("disabled",!0)):(t.firstBut.prop("disabled",!1),t.prevBut.prop("disabled",!1)),t.page==t.max?(t.lastBut.prop("disabled",!0),t.nextBut.prop("disabled",!0)):(t.lastBut.prop("disabled",!1),t.nextBut.prop("disabled",!1));for(var i=e;i<=a;i++)i>0&&i<=t.max&&t.pagesElement.append(t._generatePageButton(i));this.footerRedraw()},Page.prototype._generatePageButton=function(t){var e=this,a=$("<button class='tabulator-page "+(t==e.page?"active":"")+"' data-page='"+t+"' role='button' arpagea-label='Show Page "+t+"'>"+t+"</button>");return a.on("click",function(a){e.setPage(t)}),a},Page.prototype.previousPage=function(){return this.page>1&&(this.page--,this.trigger(),!0)},Page.prototype.nextPage=function(){return this.page<this.max&&(this.page++,this.trigger(),!0)},Page.prototype.getPage=function(){return this.page},Page.prototype.getPageMax=function(){return this.max},Page.prototype.getMode=function(){return this.mode},Page.prototype.getRows=function(t){var e,a,i;if("local"==this.mode){e=[],i=(a=this.size*(this.page-1))+this.size,this._setPageButtons();for(var n=a;n<i;n++)t[n]&&e.push(t[n]);return e}return this._setPageButtons(),t.slice(0)},Page.prototype.trigger=function(){switch(this.mode){case"local":this.table.rowManager.refreshActiveData(),this.table.options.pageLoaded(this.getPage());break;case"remote":this._getRemotePage()}},Page.prototype._getRemotePage=function(){this.table.extExists("ajax",!0)&&(this.paginator?this._getRemotePagePaginator():this._getRemotePageAuto())},Page.prototype._getRemotePagePaginator=function(){var t=this,e=t.table.extensions.ajax,a=e.getUrl();e.setUrl(t.paginator(e.getUrl(),t.page,t.size,e.getParams())),e.sendRequest(function(e){t._parseRemoteData(e)}),e.setUrl(a)},Page.prototype._getRemotePageAuto=function(){var t,e,a=this;if(t=$.extend(!0,{},a.table.extensions.ajax.getParams()),e=a.table.extensions.ajax.getParams(),e[this.paginationDataSentNames.page]=a.page,this.size&&(e[this.paginationDataSentNames.size]=this.size),this.table.extExists("sort")){var i=a.table.extensions.sort.getSort();i[0]&&"function"!=typeof i[0].column&&(e[this.paginationDataSentNames.sort]=i[0].column.getField(),e[this.paginationDataSentNames.sort_dir]=i[0].dir)}if(this.table.extExists("filter")){var n=a.table.extensions.filter.getFilter();n[0]&&"string"==typeof n[0].field&&(e[this.paginationDataSentNames.filter]=n[0].field,e[this.paginationDataSentNames.filter_type]=n[0].type,e[this.paginationDataSentNames.filter_value]=n[0].value)}a.table.extensions.ajax.setParams(e),a.table.extensions.ajax.sendRequest(function(t){a._parseRemoteData(t)}),a.table.extensions.ajax.setParams(t)},Page.prototype._parseRemoteData=function(t){t[this.paginationDataReceivedNames.last_page]&&t[this.paginationDataReceivedNames.data]&&(this.max=parseInt(t[this.paginationDataReceivedNames.last_page]),this.table.rowManager.setData(t[this.paginationDataReceivedNames.data]),this.table.options.pageLoaded(this.getPage()))},Page.prototype.footerRedraw=function(){var t=this.table.footerManager.element;t.innerWidth()-t[0].scrollWidth<0?this.pagesElement.hide():(this.pagesElement.show(),t.innerWidth()-t[0].scrollWidth<0&&this.pagesElement.hide())},Page.prototype.paginationDataSentNames={page:"page",size:"size",sort:"sort",sort_dir:"sort_dir",filter:"filter",filter_value:"filter_value",filter_type:"filter_type"},Page.prototype.paginationDataReceivedNames={current_page:"current_page",last_page:"last_page",data:"data"},Tabulator.registerExtension("page",Page);