"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sort=function(t){this.table=t,this.sortList=[],this.changed=!1};Sort.prototype.initializeColumn=function(t,o){var e=this,r=!1;switch(_typeof(t.definition.sorter)){case"string":e.sorters[t.definition.sorter]&&(r=e.sorters[t.definition.sorter]);break;case"function":r=t.definition.sorter}t.extensions.sort={sorter:r,dir:"none",params:t.definition.sorterParams||{}},!1!==t.definition.headerSort&&(t.element.addClass("tabulator-sortable"),o.append($("<div class='tabulator-arrow'></div>")),t.element.on("click",function(){t.extensions.sort&&("asc"==t.extensions.sort.dir?e.setSort(t,"desc"):e.setSort(t,"asc"),e.table.rowManager.sorterRefresh())}))},Sort.prototype.hasChanged=function(){var t=this.changed;return this.changed=!1,t},Sort.prototype.getSort=function(){var t=[];return this.sortList.forEach(function(o){o.column&&t.push({column:o.column.getComponent(),field:o.column.getField(),dir:o.dir})}),t},Sort.prototype.setSort=function(t,o){var e=this,r=[];Array.isArray(t)||(t=[{column:t,dir:o}]),t.forEach(function(t){var o;(o=e.table.columnManager.findColumn(t.column))&&(t.column=o,r.push(t),e.changed=!0)}),e.sortList=r},Sort.prototype.clear=function(){this.setSort([])},Sort.prototype.findSorter=function(t){var o,e=this.table.rowManager.activeRows[0],r="string";if(e&&(e=e.getData(),t.getField()))switch(void 0===(o=t.getFieldValue(e))?"undefined":_typeof(o)){case"undefined":r="string";break;case"boolean":r="boolean";break;default:isNaN(o)||""===o?o.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum"):r="number"}return this.sorters[r]},Sort.prototype.sort=function(){var t,o=this;o.table.options.dataSorting&&o.table.options.dataSorting(o.getSort()),o.clearColumnHeaders(),o.table.options.ajaxSorting||o.sortList.forEach(function(t,e){t.column&&t.column.extensions.sort&&(t.column.extensions.sort.sorter||(t.column.extensions.sort.sorter=o.findSorter(t.column)),o._sortItem(t.column,t.dir,o.sortList,e))}),o.sortList.length&&(t=o.sortList[o.sortList.length-1]).column&&o.setColumnHeader(t.column,t.dir),o.table.options.dataSorted&&o.table.options.dataSorted(o.getSort())},Sort.prototype.clearColumnHeaders=function(){this.table.columnManager.getRealColumns().forEach(function(t){t.extensions.sort&&(t.extensions.sort.dir="none",t.element.attr("aria-sort","none"))})},Sort.prototype.setColumnHeader=function(t,o){this.clearColumnHeaders(),t.extensions.sort.dir=o,t.element.attr("aria-sort",o)},Sort.prototype._sortItem=function(t,o,e,r){var n=this;n.table.rowManager.activeRows.sort(function(i,s){var a=n._sortRow(i,s,t,o);if(0==a&&r)for(var u=r-1;u>=0&&0==(a=n._sortRow(i,s,e[u].column,e[u].dir));u--);return a})},Sort.prototype._sortRow=function(t,o,e,r){var n=this,i="asc"==r?t:o,s="asc"==r?o:t;return t=e.getFieldValue(i.getData()),o=e.getFieldValue(s.getData()),t=void 0!==t?t:"",o=void 0!==o?o:"",e.extensions.sort.sorter.call(n,t,o,i,s,e.getComponent(),r,e.extensions.sort.params)},Sort.prototype.sorters={number:function(t,o,e,r,n,i,s){return parseFloat(String(t).replace(",",""))-parseFloat(String(o).replace(",",""))},string:function(t,o,e,r,n,i,s){return String(t).toLowerCase().localeCompare(String(o).toLowerCase())},date:function(t,o,e,r,n,i,s){var a=s.format||"DD/MM/YYYY";return"undefined"!=typeof moment&&(t=moment(t,a),o=moment(o,a)),t-o},boolean:function(t,o,e,r,n,i,s){return(!0===t||"true"===t||"True"===t||1===t?1:0)-(!0===o||"true"===o||"True"===o||1===o?1:0)},alphanum:function(t,o,e,r,n,i,s){var a,u,l,c,f,m=0,d=/(\d+)|(\D+)/g,p=/\d/;if(isFinite(t)&&isFinite(o))return t-o;if(a=String(t).toLowerCase(),u=String(o).toLowerCase(),a===u)return 0;if(!p.test(a)||!p.test(u))return a>u?1:-1;for(a=a.match(d),u=u.match(d),f=a.length>u.length?u.length:a.length;m<f;)if(l=a[m],c=u[m++],l!==c)return isFinite(l)&&isFinite(c)?("0"===l.charAt(0)&&(l="."+l),"0"===c.charAt(0)&&(c="."+c),l-c):l>c?1:-1;return a.length>u.length},time:function(t,o,e,r,n,i,s){var a=s.format||"hh:mm";return"undefined"!=typeof moment&&(t=moment(t,a),o=moment(o,a)),t-o}},Tabulator.registerExtension("sort",Sort);